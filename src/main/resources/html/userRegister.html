<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src = "./jquery-1.11.0.min.js" type = "text/javascript"></script>
        <link href="./static/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" >
        <link href="./static/assets/global/css/components.css" rel="stylesheet" type="text/css" >
        <link href="./static/assets/admin/pages/css/login.css" rel="stylesheet" type="text/css" >
        <script src="./getHost.js"  type = "text/javascript"></script>
    </head>

    <body class="login">

        <div class="content">

            <h1 class="form-title">User Registration</h1>
           
            <div class="form-group">
                <label class="control-label">Phone Number: </label><br>
                <input type = "text" placeholder="Enter Your Phone Number" id = "phone" name = "phone" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="control-label">OTP code: </label><br>
                <input type = "text" placeholder="Enter Your OTP code" id = "userOtp"  name = "userOtp" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="control-label">Name: </label><br>
                <input type = "text" placeholder="Enter Your name" id = "name"  name = "name" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="control-label">Gender: </label><br>
                <input type = "text" placeholder="Enter Your gender" id = "gender"  name = "gender" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="control-label">Age: </label><br>
                <input type = "text" placeholder="Enter Your Age" id = "age"  name = "age" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="control-label">Password: </label><br>
                <input type = "password" placeholder="Enter Your password" id = "password"  name = "password" class="form-control" required>
            </div>

            <div class="form-actions">
                <button id = "register_submit" type = "submit" class="btn blue">Register</button>
            </div>


        </div>
    </body>

    <script>

        jQuery(document).ready(function(){

            //otp button click event. Send otp request to backend
            $("#register_submit").on("click",function(){

                var otpToken = window.localStorage["otpToken"];
   
                var phone = $("#phone").val();
                var userOtp = $("#userOtp").val();
                var name = $("#name").val();
                var gender = $("#gender").val();
                var age = $("#age").val();
                var password = $("#password").val();
                

                if(phone == null || phone === ""){
                    alert("Phone cannot be empty");
                    return false;
                }
                if(userOtp == null || userOtp === ""){
                    alert("OTP cannot be empty");
                    return false;
                }
                if(name == null || name === ""){
                    alert("Name cannot be empty");
                    return false;
                }
                if(gender == null || gender === ""){
                    alert("Gender cannot be empty");
                    return false;
                }
                if(age == null || age === ""){
                    alert("Age cannot be empty");
                    return false;
                }
                if(password == null || password === ""){
                    alert("Password cannot be empty");
                    return false;
                }

                
                //Reflect to backend: @RequestMapping(value = "/register")
                $.ajax({
                    type:"POST",
                    contentType:"application/x-www-form-urlencoded",
                    url:"http://"+ g_host + "/user/register?otpToken=" + otpToken,
                    data: {
                        "phone": phone,
                        "userOtp": userOtp,
                        "name": name,
                        "gender": gender,
                        "age": age,
                        "password": password,
                    },
                    //Allow cross origin
                    xhrFields:{withCredentials:true},
                    crossDomain: true,
                    success: function(data){
                            if(data.status === "success"){
                                alert("Registration Successful");
                                window.location.href = "userLogin.html";
                            }else{
                                alert("Registration Failed : " + data.data.errMsg);
                        }
                    },
                    error: function(data){
                        alert("Registration Failed : " + data.responseText);
                    }
                });
            });
            return false;
        });

    </script>


</html>